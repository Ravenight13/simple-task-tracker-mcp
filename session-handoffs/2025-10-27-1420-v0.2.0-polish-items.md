# Session Handoff: v0.2.0 Polish Items

**Date:** 2025-10-27
**Time:** 14:20
**Session Type:** Enhancement Planning
**Status:** ðŸ“‹ BACKLOG (Non-blocking polish items)
**Current Version:** v0.1.0 (PRODUCTION READY)
**Target Version:** v0.2.0
**Priority:** Low (enhancements, not fixes)

---

## Executive Summary

v0.1.0 is **PRODUCTION READY** and fully deployed. This handoff documents **optional polish items** for v0.2.0 that will improve consistency and add convenience features, but are **not blockers** for production use.

**Current Status:** âœ… v0.1.0 deployed and working perfectly
**Next Version:** v0.2.0 (polish and enhancements)
**Timeline:** No urgency - implement when convenient

---

## v0.1.0 Production Status

**Deployment:** âœ… LIVE IN PRODUCTION
**Testing:** âœ… 100% pass rate (17/17 categories)
**Critical Issues:** âœ… ZERO
**Minor Issues:** 2 (documented below)
**User Impact:** None (all features fully functional)

---

## Enhancement Items for v0.2.0

### Enhancement 1: Standardize Timestamp Formats

**Current Behavior:**
Mixed timestamp formats in task records:
- Some fields: ISO 8601 format (`2025-10-27T08:57:25.485684`)
- Some fields: Custom format (`2025-10-27 13:55:38`)

**Examples:**
```json
{
  "created_at": "2025-10-27 13:55:38",        // Custom format
  "updated_at": "2025-10-27T08:57:59.949088", // ISO 8601
  "completed_at": "2025-10-27T08:57:25.485684" // ISO 8601
}
```

**Impact:**
- âœ… Both formats parse correctly in Python/JavaScript
- âœ… No functional issues
- âš ï¸ Inconsistency in API responses
- âš ï¸ Minor developer experience issue

**Proposed Fix:**
Standardize all timestamp fields to ISO 8601 format with microseconds:
```python
# In models.py
created_at: datetime = Field(default_factory=datetime.now)

# In database.py - when inserting
cursor.execute("""
    INSERT INTO tasks (created_at, updated_at)
    VALUES (?, ?)
""", (
    datetime.now().isoformat(),  # ISO 8601
    datetime.now().isoformat()   # ISO 8601
))
```

**Files to Update:**
- `src/task_mcp/database.py` (timestamp insertion)
- `src/task_mcp/models.py` (validate format consistency)
- `tests/test_database.py` (update timestamp assertions)

**Estimated Effort:** 10-15 minutes
**Priority:** Low (cosmetic improvement)
**Breaking Change:** No (both formats still parse)

---

### Enhancement 2: Auto-Capture Conversation ID (created_by)

**Current Behavior:**
The `created_by` field is always `null` for all tasks.

**Design Intent:**
The field was designed to capture the conversation ID from MCP context to track which conversation/session created each task.

**Why It's Null:**
MCP context integration not yet implemented. The field exists in the schema but isn't populated.

**Impact:**
- âœ… Field is optional by design
- âœ… No functional impact
- â„¹ï¸ Can't track which conversation created which task
- â„¹ï¸ Manual workaround: Pass `created_by` parameter explicitly

**Current Workaround:**
```python
# Users can manually specify created_by
create_task(
    title="My Task",
    created_by="session-abc-123"  # Manual tracking
)
```

**Proposed Enhancement:**
Auto-capture conversation ID from MCP context when available:

```python
# In server.py
@mcp.tool()
async def create_task(
    title: str,
    workspace_path: str | None = None,
    created_by: str | None = None,
    # ... other params
) -> dict:
    # Get MCP context if available
    if created_by is None:
        try:
            context = mcp.get_context()
            created_by = context.get("conversation_id")
        except:
            pass  # Leave as None if context unavailable

    # Create task with auto-captured created_by
    ...
```

**Benefits:**
- Automatic conversation tracking
- Useful for multi-session projects
- Can trace task origin to specific conversations
- Still optional (gracefully handles missing context)

**Files to Update:**
- `src/task_mcp/server.py` (add context capture)
- `tests/test_mcp_tools.py` (test context integration)
- `README.md` (document auto-capture behavior)

**Estimated Effort:** 15-20 minutes
**Priority:** Low (convenience feature)
**Breaking Change:** No (field already exists, just auto-populates)

---

### Enhancement 3: Fix TaskUpdate Partial Update Validation

**Current Issue:**
TaskUpdate Pydantic model validates `None` values for `priority` field, requiring workarounds for partial updates.

**Current Workaround:**
```python
# Must include current values even when not changing them
update_task(
    task_id=1,
    title="New Title",
    status=current_status,   # Must include
    priority=current_priority  # Must include
)
```

**Root Cause:**
Pydantic validators run on `None` values:
```python
class TaskUpdate(BaseModel):
    priority: str | None = None

    @field_validator("priority")
    def validate_priority(cls, v):
        if v is not None and v not in ("low", "medium", "high"):
            raise ValueError(f"Priority must be one of ('low', 'medium', 'high'), got '{v}'")
        return v
```

**Proposed Fix:**
Update validators to handle `None` gracefully:
```python
@field_validator("priority")
def validate_priority(cls, v):
    # Early return if None (no update to this field)
    if v is None:
        return v

    # Only validate non-None values
    if v not in ("low", "medium", "high"):
        raise ValueError(f"Priority must be one of ('low', 'medium', 'high'), got '{v}'")
    return v
```

**Benefits:**
- True partial updates (only specify changed fields)
- Better API ergonomics
- Consistent with REST PATCH semantics

**Files to Update:**
- `src/task_mcp/models.py` (update validators)
- `tests/test_models.py` (test partial updates)
- `docs/subagent-reports/production-testing/` (remove workaround notes)

**Estimated Effort:** 10-15 minutes
**Priority:** Medium (quality of life improvement)
**Breaking Change:** No (makes API more permissive)

---

## Additional Enhancement Ideas (Optional)

### Enhancement 4: Bulk Operations
**Motivation:** Efficiency for creating/updating multiple tasks
**Proposed Tools:**
- `bulk_create_tasks(tasks: list[TaskCreate])`
- `bulk_update_tasks(updates: list[TaskUpdate])`
- `bulk_delete_tasks(task_ids: list[int])`

**Estimated Effort:** 30-45 minutes
**Priority:** Low (optimization)

---

### Enhancement 5: Advanced Filtering
**Motivation:** More powerful task queries
**Proposed Features:**
- Date range filtering (`created_after`, `created_before`)
- Multiple status filtering (`status__in=["todo", "in_progress"]`)
- Tag-based queries with AND/OR logic
- Combined filters (`status=todo AND priority=high`)

**Estimated Effort:** 45-60 minutes
**Priority:** Low (advanced use cases)

---

### Enhancement 6: Export Functionality
**Motivation:** Data portability and backups
**Proposed Tools:**
- `export_tasks_csv(workspace_path, filters)`
- `export_tasks_json(workspace_path, filters)`
- `export_project_backup(workspace_path)` (full SQLite dump)

**Estimated Effort:** 30-45 minutes
**Priority:** Low (utility feature)

---

### Enhancement 7: Task Templates
**Motivation:** Reusable task patterns
**Proposed Features:**
- Save task as template
- Create task from template
- Template library management

**Estimated Effort:** 60-90 minutes
**Priority:** Low (advanced feature)

---

## Implementation Priority for v0.2.0

### High Priority (Recommended)
1. **TaskUpdate Partial Validation Fix** (10-15 min)
   - Most impactful quality-of-life improvement
   - Removes workaround requirement

### Medium Priority (Nice to Have)
2. **Timestamp Standardization** (10-15 min)
   - Improves API consistency
   - Low effort, high polish

3. **Auto-Capture created_by** (15-20 min)
   - Useful for session tracking
   - No breaking changes

### Low Priority (Future Consideration)
4. Bulk operations
5. Advanced filtering
6. Export functionality
7. Task templates

---

## Testing Strategy for v0.2.0

### Regression Testing
- âœ… All 54 existing integration tests must pass
- âœ… All 17 production test categories must pass
- âœ… Cross-client validation (Code + Desktop)

### New Tests
- Timestamp format validation (all fields ISO 8601)
- created_by auto-capture (with and without MCP context)
- TaskUpdate partial updates (no workaround needed)

### Performance Testing
- Verify no performance regression
- Benchmark with 1,000+ tasks
- Concurrent access stress test

---

## Breaking Changes

**v0.2.0 will have ZERO breaking changes:**
- All fixes make API more permissive or consistent
- Existing code continues to work
- Backward compatible with v0.1.0 data

---

## Documentation Updates for v0.2.0

### README.md
- Remove TaskUpdate workaround notes
- Document auto-capture behavior for created_by
- Update examples with improved API

### CHANGELOG.md (Create)
```markdown
# Changelog

## [0.2.0] - TBD

### Added
- Auto-capture conversation ID in created_by field when available

### Changed
- Standardized all timestamp fields to ISO 8601 format
- TaskUpdate validators now handle None values properly (true partial updates)

### Fixed
- TaskUpdate no longer requires priority field for partial updates

## [0.1.0] - 2025-10-27

### Added
- Initial release with 13 MCP tools
- SQLite WAL mode for concurrent access
- Task hierarchy support (parent/subtasks)
- Dependency management with blocking
- Project registry and workspace isolation
- Soft delete with 30-day retention
- Full-text search on title/description
```

### Migration Guide (Not Needed)
No migration required - v0.2.0 is backward compatible with v0.1.0 databases.

---

## v0.1.0 Achievements (Reference)

**What shipped in v0.1.0:**
- âœ… 13 MCP tools (CRUD, advanced queries, maintenance, project management)
- âœ… 54 integration tests (100% pass rate)
- âœ… 870 lines of documentation
- âœ… SQLite WAL mode (concurrent access)
- âœ… Task hierarchy (parent/subtasks)
- âœ… Dependency management
- âœ… Validation constraints
- âœ… Soft delete (30-day retention)
- âœ… Project registry (multi-workspace)
- âœ… Full-text search
- âœ… Cross-client validation (Code + Desktop)
- âœ… Zero critical bugs

**Production Status:** LIVE and WORKING

---

## When to Implement v0.2.0

**No Rush!** These are polish items, not fixes.

**Recommended Triggers:**
1. User feedback requests any of these features
2. Accumulate more enhancement requests (batch implementation)
3. Natural development downtime
4. After real-world usage reveals priorities

**Don't Implement If:**
- Users happy with current functionality
- Other features have higher priority
- Real-world usage hasn't validated need

---

## Questions for Future Implementer

**Q1:** Are users manually tracking created_by, or is it unused?
- If unused: Low priority
- If manual tracking: Higher priority for auto-capture

**Q2:** Do timestamp format inconsistencies cause issues?
- If no complaints: Low priority
- If causing parsing issues: Higher priority

**Q3:** Is the TaskUpdate workaround acceptable?
- If users comfortable: Low priority
- If causing friction: Higher priority (easiest fix)

**Q4:** What features do users actually request?
- Prioritize based on real demand, not assumptions

---

## File References

**Current Implementation:**
- `src/task_mcp/models.py` - Pydantic models and validators
- `src/task_mcp/database.py` - SQLite operations and timestamps
- `src/task_mcp/server.py` - FastMCP tool definitions

**Test Files:**
- `tests/test_models.py` - Model validation tests
- `tests/test_database.py` - Database operation tests
- `tests/test_mcp_tools.py` - MCP tool integration tests

**Documentation:**
- `README.md` - User guide
- `CLAUDE.md` - Architecture guide
- `docs/MCP_CONFIGURATION.md` - Setup guide

---

## Estimated Total Effort for Core v0.2.0

**High-priority items:**
1. TaskUpdate fix: 10-15 min
2. Timestamp standardization: 10-15 min
3. Auto-capture created_by: 15-20 min

**Total:** 35-50 minutes for all three core enhancements
**Testing:** +15-20 minutes (regression + new tests)
**Documentation:** +10-15 minutes (README, CHANGELOG)

**Grand Total:** ~60-90 minutes for polished v0.2.0 release

---

## Success Criteria for v0.2.0

- [ ] All timestamps use ISO 8601 format consistently
- [ ] created_by auto-populates when MCP context available
- [ ] TaskUpdate allows true partial updates (no workaround)
- [ ] All 54 existing tests still pass
- [ ] Cross-client validation still works (Code + Desktop)
- [ ] No performance regression
- [ ] CHANGELOG.md created
- [ ] README.md updated (remove workarounds)
- [ ] Zero breaking changes from v0.1.0

---

## Final Recommendation

**Ship v0.1.0 as-is:** âœ… PRODUCTION READY
**Schedule v0.2.0:** When convenient (no urgency)
**Priority:** Low (polish, not fixes)

v0.1.0 is fully functional and deployed. These enhancements will make it even better, but they're **not blockers** for production use.

---

**Handoff Complete**
**Next Action:** Use v0.1.0 in production, gather feedback, implement v0.2.0 when appropriate

**v0.1.0 Status:** ðŸš€ **SHIPPED AND WORKING**
